# Описание

**Bitplot** - это приложение для OC Manjaro Linux, предназначенное для визуального отображении информации о битрейте, полученном при прослушивании RTSP-потока с одного, или нескольких устройств, используя библиотеки Wireshark. ПО разработано с целью оптимизации обработки данных для экономии ОЗУ и уменьшения объема полученной информации с возможностью ее дальнейшего хранения на дисках стандартного объема.

> [!NOTE]
> Данное ПО предназначено для долговременного сбора информации (час и более) с последующей ее отрисовкой в виде графиков. ПО не предусматривает просмотр собираемых данных в режиме реального времени. Для данных целей используйте **I/O Graphs** в **ПО Wireshark**.

# Подготовка к установке

Для установки и подготовки ПО к пользованию выполните следующие шаги:

1. Проверьте наличие следующих пакетов и установите их при отсутствии в системе;
   
   - [wireshark-qt](https://archlinux.org/packages/extra/x86_64/wireshark-qt/)
   - [ffmpeg](https://archlinux.org/packages/extra/x86_64/ffmpeg/)

```
sudo pamac install wireshark-qt ffmpeg
```

2. Создайте группу **wireshark**;
```
sudo groupadd wireshark
```

3. Добавьте себя в группу wireshark;
```
sudo usermod -a -G wireshark $USER
```

4. Установите новые параметры разрешений для ПО **dumpcap** и **tshark**;
```
sudo chown 0:wireshark $(sudo which dumpcap) $(sudo which tshark)
```

5. Назначьте сетевые возможности для ПО dumpcap;
```
sudo setcap cap_net_raw,cap_net_admin=ep $(sudo which dumpcap)
```

6. Перезагрузите ПК.

# Установка ПО

1. Скачайте архив “bitplot_v.x.x.tar.xz” из [списка релизов](https://github.com/lexduke/bitplot/releases);

2. Создайте папку “Bitplot” в домашней директории;
```
mkdir ~/Bitplot
```

3. Разархивируйте скачанный архив и переместите оттуда исполняемый файл “bitplot” в созданную папку “Bitplot”;
```
tar -xvf bitplot_v.x.x.tar.xz -C ~/Bitplot bitplot
```

4. Назначте права запуска “bitplot” как исполняемому файлу;
```
sudo chmod +x ~/Bitplot/bitplot
```

5. ПО Bitplot готово к использованию.

# Интерфейс
![interface-80-1.png](https://i.postimg.cc/Z5Cf9jRT/interface-80-1.png)

Интерфейс Bitplot состоит из нескольких элементов:

1. Панели IP адресов;
2. Поля ввода времени записи;
3. Полей ввода расположения файлов;
4. Панели начала записи и анализа данных.

На панели IP адресов (1) возможно:

- Ввести новый адрес IP в поле ввода и добавить его в список, нажав на кнопку “Добавить IP адрес”;
- Выбрать в списке IP адреса и удалить их из списка, нажав на кнопку “Удалить выбранные”;
- Отчистить весь список, нажав на кнопку “Отчистить список”.

На панели ввода времени записи (2) возможно:

- Задать время записи от 1 до 99999 сек;

> [!WARNING]
> При записи менее 3 секунд минимальный, средний и максимальный битрейт рассчитаны НЕ будут!

- Посмотреть приблизительное время анализа данных после их записи;
- Посмотреть суммарное время процесса записи и анализа данных.

На панели ввода расположения файлов (3) возможно:

- Указать директорию для сохранения базы данных прослушанных IP, или для дальнейшего анализа уже имеющейся базы данных в виде файла bpt.pcapng (директория по-умолчанию - `/tmp`)
- Указать директорию для сохранения обработанных данных прослушанных IP, или для дальнейшего анализа уже имеющихся обработанных данных в виде файла bpt.csv (директория по-умолчанию - `/tmp`)

> [!NOTE]
> При указании пути убедитесь:
> 1. У Вас (пользователя, запустившего ПО) есть доступ к указанной директории и файлам, содержащимся в ней;
> 2. Файлы базы данных и обработанных данных имеют названия bpt.pcapng и bpt.csv соответственно. В противном случае ПО выдаст ошибку об отсутствии данных;
> 3. Вы указали путь к директории расположения файла, а не к самому файлу. Пример:
>    - ✅ Верно: `/home/username`
>    - ⛔ Неверно: `/home/username/bpt.csv`

На панели начала записи и анализа данных (4) возможно:
- Начать запись данных по указанным IP адресам с сохранением данных в указанных директориях с последующим анализом и выводом в виде графиков (кнопка “Запустить запись и анализ новых данных”);
- Начать анализ данных данных из указанной директории по указанным IP адресам с последующим выводом в виде графиков (кнопки “Запустить анализ данных из .pcapng” и “Запустить анализ данных из .csv”).

> [!IMPORTANT]
> Для начала записи и/или анализа данных все поля и списки должны быть заполнены и валидны!

# Как пользоваться?
Для выполнения стандартного сбора и анализа данных выполните следующие шаги:

1. Запустите устройство, передающее RTSP-поток (камеру);
2. Подключитесь к RTSP-потоку(-ам) при помощи ПО ffmpeg;
```
ffplay ссылка_rtsp_потока
```
3. Запустите **Bitplot**;
4. Внесите в список IP адрес(-а) и задайте время сбора данных;
5. Запустите запись и анализ новых данных;
6. Дождитесь окончания процесса.

# Куда сохраняются графики?
- Сохранение графиков производится в папку `plots` в корне приложения (при отсутствии создается автоматически).
- Данные делятся на подпапки, наименование которых соответствуюет дате записи данных.
- При записи нескольких камер данные сортируются в отдельные папки по IP отправителя, а также создается отдельная папка `multiple` с объединенной информацией со всех IP отправителей для упрощения сравнительного анализа.
- Данные внутри папок разделяются на получасовые отрезки как наиболее оптимальный масштаб для просмотра информации, а также создается график с полным отрезком на протяжении всего времени записи и файл `bitrate_info.txt` с информацией о минимальном, среднем и максимальном битрейте на протяжении всей записи.
